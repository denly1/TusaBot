# Инструкция по обновлению TusaBot

## Что изменилось:

1. **Возраст вместо даты рождения** - теперь пользователи вводят просто число (возраст)
2. **Убрана команда /admin** из меню для обычных пользователей
3. **Исправлено сохранение данных** в базу данных
4. **Предотвращена повторная регистрация** - при /start показывается "уже зарегистрированы"
5. **Запоминание VK аккаунта** работает корректно

## Шаги обновления:

### 1. Обновите базу данных
Выполните в pgAdmin или psql:
```sql
-- Подключитесь к базе largent и выполните:
\i update_database.sql
```

Или скопируйте содержимое файла `update_database.sql` и выполните в Query Tool.

### 2. Перезапустите бота
```bash
python bot.py
```

## Что теперь работает:

### Регистрация:
1. `/start` - начало регистрации или "уже зарегистрированы"
2. Ввод имени
3. Выбор пола (мужской/женский)
4. Ввод возраста (число от 16 до 100)
5. Завершение регистрации

### Команды:
- `/start` - регистрация или главное меню
- `/menu` - главное меню (только для зарегистрированных)
- `/admin` - админ-панель (только для админов, не видна обычным пользователям)

### Проверка подписок:
- Telegram канал - работает как раньше
- VK группа - работает как раньше
- Привязка VK профиля - сохраняется в базу данных

### База данных:
- Все данные сохраняются корректно
- VK ID запоминается
- Возраст вместо даты рождения
- Excel экспорт обновлен под новую схему

## Проверка работы:

1. Отправьте `/start` боту
2. Если уже зарегистрированы - увидите сообщение с данными
3. Если нет - пройдите регистрацию заново
4. Проверьте что данные сохраняются в базу:
   ```sql
   SELECT * FROM users ORDER BY registered_at DESC LIMIT 5;
   ```

## Важно:

- **Система проверок подписок НЕ ТРОНУТА** - все работает как раньше
- Старые пользователи должны пройти регистрацию заново (возраст вместо даты)
- Команда `/admin` больше не видна обычным пользователям в меню Telegram
