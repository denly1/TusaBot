# Настройка VK API для TusaBot

## Что нужно для работы VK функций:

### 1. **VK токен доступа**
Для проверки подписок на VK группу нужен токен с правами `groups`.

### 2. **ID вашей VK группы**
Нужен числовой ID группы (не короткое имя).

## Как получить VK токен:

### Способ 1: Через VK Dev (рекомендуется)
1. Перейдите на https://dev.vk.com/
2. Создайте новое приложение типа "Standalone"
3. Получите токен с правами `groups`

### Способ 2: Через Implicit Flow
1. Откройте в браузере:
```
https://oauth.vk.com/authorize?client_id=YOUR_APP_ID&display=page&redirect_uri=https://oauth.vk.com/blank.html&scope=groups&response_type=token&v=5.131
```
2. Замените `YOUR_APP_ID` на ID вашего приложения
3. Разрешите доступ
4. Скопируйте токен из адресной строки

## Как найти ID VK группы:

### Способ 1: Через адрес группы
Если группа: `https://vk.com/largent.tusa`
- Короткое имя: `largent.tusa`
- Нужно получить числовой ID через API

### Способ 2: Через VK API
Выполните запрос:
```
https://api.vk.com/method/utils.resolveScreenName?screen_name=largent.tusa&access_token=YOUR_TOKEN&v=5.131
```

Ответ будет содержать `object_id` - это и есть ID группы.

## Настройка в .env файле:

```env
# VK интеграция
VK_TOKEN=ваш_vk_токен_с_правами_groups
VK_GROUP_DOMAIN=largent.tusa
```

## Как работает проверка подписки:

1. **Пользователь вводит свой VK ID** (только цифры)
2. **Бот проверяет подписку** через VK API метод `groups.isMember`
3. **Результат:**
   - ✅ Подписан
   - ❌ Не подписан  
   - ❓ Не удалось проверить (закрытый профиль/подписки)

## Требования к VK профилям пользователей:

### Для корректной работы пользователи должны:
1. **Иметь открытый профиль** или открытые подписки
2. **Знать свой VK ID** (цифры после vk.com/id)
3. **Быть подписанными на группу**

### Как пользователь может найти свой VK ID:
1. Открыть свой профиль VK
2. В адресной строке будет: `vk.com/id123456789`
3. Скопировать цифры после `id`: `123456789`

## Возможные проблемы:

### Ошибка "Не удалось проверить подписку":
- Профиль пользователя закрыт
- Подписки скрыты от просмотра
- Неверный VK токен
- Проблемы с VK API

### Ошибка "Неверный формат VK ID":
- Пользователь ввел не только цифры
- Пользователь ввел короткое имя вместо ID

## Тестирование:

1. **Проверьте токен:**
```
https://api.vk.com/method/groups.getById?group_id=largent.tusa&access_token=YOUR_TOKEN&v=5.131
```

2. **Проверьте подписку:**
```
https://api.vk.com/method/groups.isMember?group_id=GROUP_ID&user_id=USER_ID&access_token=YOUR_TOKEN&v=5.131
```

## Функции бота с VK:

### Для пользователей:
- Привязка VK профиля по ID
- Автоматическая проверка подписки
- Уведомления о статусе подписки

### Для админов:
- Рассылка постов в VK группу
- Статистика пользователей с VK
- Экспорт VK данных в Excel

## Безопасность:

- Токен VK храните в `.env` файле
- Не публикуйте токен в коде
- Регулярно обновляйте токен
- Используйте минимальные необходимые права
