# Исправление проблемы с базой данных

## Проблема
В базе данных все еще есть колонка `birthdate`, а код ожидает `age`.

## Решение

### 1. Выполните SQL скрипт
Откройте pgAdmin, подключитесь к базе `largent` и выполните содержимое файла `fix_database.sql`:

```sql
-- Проверяем текущую структуру
SELECT column_name, data_type FROM information_schema.columns 
WHERE table_name = 'users' ORDER BY ordinal_position;

-- Добавляем колонку age если её нет
ALTER TABLE users ADD COLUMN IF NOT EXISTS age INTEGER CHECK (age >= 16 AND age <= 100);

-- Удаляем старую колонку birthdate
ALTER TABLE users DROP COLUMN IF EXISTS birthdate;

-- Очищаем таблицу от старых данных
TRUNCATE TABLE users;
```

### 2. Перезапустите бота
```bash
python bot.py
```

### 3. Проверьте работу
1. Отправьте `/start` боту
2. Пройдите регистрацию: имя → пол → возраст
3. Проверьте что данные сохранились:
   ```sql
   SELECT * FROM users;
   ```

## Что исправлено в коде:
- ✅ Добавлено логирование в `upsert_user`
- ✅ Сохранение имени на этапе ввода имени
- ✅ Сохранение пола на этапе выбора пола  
- ✅ Сохранение возраста на этапе ввода возраста

## Логи для отладки
Теперь в логах бота вы увидите:
```
INFO - Upserting user 825042510: name=Саша, gender=None, age=None, vk_id=None
INFO - Successfully upserted user 825042510
```

Это поможет понять на каком этапе происходит ошибка.
